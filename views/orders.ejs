<%- include('partials/header') %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>My Orders</h2>
  <a href="/homepage" class="btn btn-outline-primary">Back to Homepage</a>
</div>

<div class="card shadow mb-4">
  <div class="card-header bg-primary text-white">
    <h4 class="mb-0">Order History</h4>
  </div>
  <div class="card-body">
    <% if (orders && orders.length > 0) { %>
      <div class="table-responsive">
        <table class="table table-striped table-bordered">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Product</th>
              <th>Seller</th>
              <th>Quantity</th>
              <th>Unit Price</th>
              <th>Total</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            <% orders.forEach(order => { %>
              <tr>
                <td><%= order.oid %></td>
                <td>
                  <a href="/products/<%= order.pid %>" data-toggle="tooltip" data-placement="top" title="Click to view product details">
                    <%= order.product.pname %>
                  </a>
                </td>
                <td><%= order.seller ? order.seller.sname : 'Unknown' %></td>
                <td><%= order.quantity %></td>
                <td>$<%= order.product.price.toFixed(2) %></td>
                <td>$<%= (order.quantity * order.product.price).toFixed(2) %></td>
                <td><%= new Date(order.timestamp).toLocaleString() %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <div class="alert alert-info text-center">
        <h4>No orders found.</h4>
        <p>You haven't placed any orders yet.</p>
        <a href="/homepage" class="btn btn-primary mt-2">Browse Products</a>
      </div>
    <% } %>
  </div>
</div>

<%- include('partials/footer') %>

<script>
  // Enable tooltips on page load
  $(function () {
    $('[data-toggle="tooltip"]').tooltip();
  });
</script>
